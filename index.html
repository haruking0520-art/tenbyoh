<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Band Practice Mixer</title>
<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background: #111;
  color: white;
}
.slider { width: 80%; margin: 10px; }
.timeline { width: 90%; margin-top: 20px; }
button {
  padding: 10px 20px;
  margin: 10px;
  font-size: 16px;
  border-radius: 6px;
  border: none;
}
.play { background: #28a745; color: white; }
.stop { background: #dc3545; color: white; }
</style>
</head>
<body>

<h2>ðŸŽ¸ Band Practice Mixer</h2>

<div>Drums<br><input class="slider" type="range" min="0" max="1" step="0.01" value="1" id="volDr"></div>
<div>Bass<br><input class="slider" type="range" min="0" max="1" step="0.01" value="1" id="volBa"></div>
<div>Guitar1<br><input class="slider" type="range" min="0" max="1" step="0.01" value="1" id="volGt1"></div>
<div>Guitar2<br><input class="slider" type="range" min="0" max="1" step="0.01" value="1" id="volGt2"></div>
<div>Piano<br><input class="slider" type="range" min="0" max="1" step="0.01" value="1" id="volPi"></div>
<div>Vocal1<br><input class="slider" type="range" min="0" max="1" step="0.01" value="1" id="volVo1"></div>
<div>Vocal2<br><input class="slider" type="range" min="0" max="1" step="0.01" value="1" id="volVo2"></div>

<input type="range" id="timeline" class="timeline" value="0" min="0" step="0.01">
<br>
<span id="timeDisplay">0:00</span>

<br>
<button class="play" onclick="playAll()">â–¶ Play</button>
<button class="stop" onclick="stopAll()">â–  Stop</button>

<script>
let context;
let buffers = {};
let gainNodes = {};
let sources = [];
let startTime = 0;
let pauseOffset = 0;
let duration = 0;
let timer;

const files = {
  dr: "Dr.mp3",
  ba: "Ba.mp3",
  gt1: "Gt1.mp3",
  gt2: "Gt2.mp3",
  pi: "Pi.mp3",
  vo1: "Vo1.mp3",
  vo2: "Vo2.mp3"
};

async function loadAudio() {
  context = new (window.AudioContext || window.webkitAudioContext)();

  for (let key in files) {
    const response = await fetch(files[key]);
    const arrayBuffer = await response.arrayBuffer();
    buffers[key] = await context.decodeAudioData(arrayBuffer);

    gainNodes[key] = context.createGain();
    gainNodes[key].connect(context.destination);
  }

  duration = buffers["dr"].duration;
  document.getElementById("timeline").max = duration;
}

async function playAll() {
  if (!context) await loadAudio();

  await context.resume();

  startTime = context.currentTime - pauseOffset;
  sources = [];

  for (let key in buffers) {
    const source = context.createBufferSource();
    source.buffer = buffers[key];
    source.connect(gainNodes[key]);
    source.start(0, pauseOffset);
    sources.push(source);
  }

  timer = setInterval(updateTimeline, 100);
}

function stopAll() {
  sources.forEach(s => s.stop());
  pauseOffset = 0;
  clearInterval(timer);
  document.getElementById("timeline").value = 0;
  document.getElementById("timeDisplay").textContent = "0:00";
}

function updateTimeline() {
  const current = context.currentTime - startTime;
  pauseOffset = current;
  document.getElementById("timeline").value = current;
  document.getElementById("timeDisplay").textContent = formatTime(current);
}

document.getElementById("timeline").oninput = function() {
  pauseOffset = this.value;
  stopAll();
  playAll();
};

function formatTime(sec) {
  const m = Math.floor(sec / 60);
  const s = Math.floor(sec % 60).toString().padStart(2, "0");
  return m + ":" + s;
}

// ãƒœãƒªãƒ¥ãƒ¼ãƒ åˆ¶å¾¡
document.getElementById("volDr").oninput = e => gainNodes.dr.gain.value = e.target.value;
document.getElementById("volBa").oninput = e => gainNodes.ba.gain.value = e.target.value;
document.getElementById("volGt1").oninput = e => gainNodes.gt1.gain.value = e.target.value;
document.getElementById("volGt2").oninput = e => gainNodes.gt2.gain.value = e.target.value;
document.getElementById("volPi").oninput = e => gainNodes.pi.gain.value = e.target.value;
document.getElementById("volVo1").oninput = e => gainNodes.vo1.gain.value = e.target.value;
document.getElementById("volVo2").oninput = e => gainNodes.vo2.gain.value = e.target.value;
</script>

</body>
</html>
